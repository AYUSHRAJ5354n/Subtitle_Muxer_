# koyeb.yaml - Deploys both a web service and a worker

name: subtitle-muxer-app

services:
  # 1. The Web Service for the status page
  - name: web-status
    type: web
    docker:
      dockerfile: ./Dockerfile
    # Command to start the web server
    command: "gunicorn"
    args:
      - "web:app"
      - "--bind"
      - "0.0.0.0:8000" # Koyeb exposes port 8000
    instance_class: free
    ports:
      - port: 8000
        protocol: http
    routes:
      - path: /
        port: 8000

  # 2. The Background Worker for the actual bot
  - name: bot-worker
    type: worker
    docker:
      dockerfile: ./Dockerfile
    command: "python"
    args:
      - "bot.py"
    instance_class: free
    env:
      - key: API_ID
        scope: secret
        value: api-id
      - key: API_HASH
        scope: secret
        value: api-hash
      - key: BOT_TOKEN
        scope: secret
        value: bot-token
      - key: MONGO_URI
        scope: secret
        value: mongo-uri
      - key: ADMIN_IDS
        scope: secret
        value: admin-ids
